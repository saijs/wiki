<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="nico 0.4.7">
    <meta name="theme" content="markwiki 0.1">
    <title>Script error.</title>
<script type="text/javascript">
</script>
    <link rel="stylesheet" href="../static/one.css" />
    <link rel="stylesheet" href="../static/codes.css" />
    <link rel="stylesheet" href="../static/syntax.css" />
  </head>
  <body>
    <div class="navigation" role="navigation">
      <div class="container">
        <!--<a class="home" href="../"></a>-->
        <div class="menu">
          <ul>
            <li><a href="../../../../../">首页</a></li>
            <li><a href="../../../../../wiki">异常列表</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="document">
<div class="hentry">
  <h1 class="entry-title">Script error.</h1>
  <div class="entry-content"><table><thead>
<tr>
<th width="100">Language</th>
<th>Message</th>
<th width="100">Browser</th>
<th>备注</th>
</tr>
</thead><tbody>
<tr>
<td>英文</td>
<td>Script error.</td>
<td>Firefox, Chrome, Safari, Opera.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Script Error: 0x80072ee4</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="分析">分析</h2>
<p>异常信息通常如下：</p>

<table><thead>
<tr>
<th width="100">异常字段</th>
<th>值</th>
</tr>
</thead><tbody>
<tr>
<td>Message</td>
<td>Script error.</td>
</tr>
<tr>
<td>File</td>
<td>(空)</td>
</tr>
<tr>
<td>Line</td>
<td>0</td>
</tr>
</tbody></table>

<ol>
<li>在某些版本的 Firefox 中，地址栏执行脚本 <code>javascript:notExistFunction()</code>
代码，Firebug 可以提示正确的 <code>&quot;notExistFunction&quot; is undefined</code>，
但是 onerror 异常事件处理函数中得到的错误消息却是 <code>Script error.</code>。</li>
<li>用户脚本(userscript) 异常导致。</li>
<li>因为同源策略，Firefox, Chrome, Safari 等浏览器，
页面引用的非同域的外部脚本中抛出了异常，本页面无权限获得这个异常详情，
所以就成了 <code>Script error.</code>。静态脚本使用独立域名未必就一定是件好事啊。</li>
</ol>
<h2 id="案例">案例</h2>
<p>a.com/a.html</p>
<div class="highlight"><pre><code class="xml"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
    window.onerror = <span class="keyword">function</span>(m,f,l){
        <span class="keyword">var</span> s = <span class="string">"message:"</span>+m+<span class="string">", file:"</span>+f+<span class="string">", line:"</span>+l;
        console.log(s);
        window.status = s;
    };
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"b.com/b.html"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre></div>
<p>这里 a.com/a.html 页面引用了 b.com/b.html 脚本『注意：b.html 是一个页面』，
这时会抛出异常：</p>

<table><thead>
<tr>
<th width="100">Browser</th>
<th>type</th>
<th>Message</th>
<th>File</th>
<th>Line</th>
</tr>
</thead><tbody>
<tr>
<td>IE</td>
<td>console</td>
<td>语法错误</td>
<td>b.com/b.html</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>语法错误</td>
<td>b.com/b.html</td>
<td>1</td>
</tr>
<tr>
<td>Firefox</td>
<td>console</td>
<td>syntax error</td>
<td>b.com/b.html</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Chrome</td>
<td>console</td>
<td>Uncaught SyntaxError: Unexpected token &lt;</td>
<td>b.com/b.html</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Safari</td>
<td>console</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Opera</td>
<td>console</td>
<td>Syntax error at line 1 while loading: expected expression, got &#39;&lt;&#39;<br />&lt;!DOCTYPE html PUBLI <br />^</td>
<td>a.com/a.html</td>
<td>4</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
</tbody></table>

<p>引入外部脚本，该外部脚本会抛出异常：</p>

<p>a.com/a.html</p>
<div class="highlight"><pre><code class="xml"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
    window.onerror = <span class="keyword">function</span>(m,f,l){
        <span class="keyword">var</span> s = <span class="string">"message:"</span>+m+<span class="string">", file:"</span>+f+<span class="string">", line:"</span>+l;
        console.log(s);
        window.status = s;
    };
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"b.com/b.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre></div>
<p>b.com/b.js</p>
<div class="highlight"><pre><code class="javascript"><span class="comment">// some comments</span>
<span class="comment">// for lines.</span>
<span class="keyword">var</span> a = ;
</code></pre></div>
<table><thead>
<tr>
<th width="100">Browser</th>
<th>type</th>
<th>Message</th>
<th>File</th>
<th>Line</th>
</tr>
</thead><tbody>
<tr>
<td>IE</td>
<td>console</td>
<td>语法错误</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>语法错误</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td>Firefox</td>
<td>console</td>
<td>syntax error</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Chrome</td>
<td>console</td>
<td>Uncaught SyntaxError: Unexpected token ;</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Safari</td>
<td>console</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Opera</td>
<td>console</td>
<td>Syntax error at line 3 while loading: expected expression, got &#39;;&#39;<br/>var a = ;<br/>--------^</td>
<td>a.com/a.html</td>
<td>4</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
</tbody></table>

<p>特殊的，如果是脚本中主动掷出的异常，Safari 会稍有不同。</p>

<p>b.com/b.js</p>
<div class="highlight"><pre><code class="javascript"><span class="comment">// some comments</span>
<span class="comment">// for lines.</span>
<span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"test error on b."</span>);
</code></pre></div>
<table><thead>
<tr>
<th width="100">Browser</th>
<th>type</th>
<th>Message</th>
<th>File</th>
<th>Line</th>
</tr>
</thead><tbody>
<tr>
<td>IE</td>
<td>console</td>
<td>test error on b.</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>test error on b.</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td>Firefox</td>
<td>console</td>
<td>test error on b.</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Chrome</td>
<td>console</td>
<td>Uncaught Error: test error on b.</td>
<td>b.com/b.js</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Safari</td>
<td>console</td>
<td>Error: test error on b.</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>undefined</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Opera</td>
<td>console</td>
<td>Uncaught exception: Error: test error on b.</td>
<td>a.com/a.html</td>
<td>4</td>
</tr>
<tr>
<td></td>
<td>onerror</td>
<td>Script error.</td>
<td></td>
<td>0</td>
</tr>
</tbody></table>
<h2 id="参考">参考</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox">Cryptic “Script Error.” reported in Javascript in Chrome and Firefox</a></li>
<li><a href="http://trac.webkit.org/browser/branches/chromium/648/Source/WebCore/dom/ScriptExecutionContext.cpp?rev=77122#L301">WebKit source that checks origin</a></li>
<li><a href="http://mxr.mozilla.org/mozilla-beta/source/dom/base/nsJSEnvironment.cpp#316">Firefox source that checks</a></li>
<li><a href="http://en.wikipedia.org/wiki/Same_origin_policy">Same origin policy</a></li>
</ul>
</div>
  <div class="comments">
    <h2 id="discuss">讨论
      <a class="title-permalink" title="Permalink to this title" href="#discuss">¶</a>
    </h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jserr'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</div>
</div>
    <div class="footer">
      <p class="copyright">JavaScript 异常档案</p>
      <!--<p class="copyright">powered by <a href="http://lab.lepture.com/nico/">nico</a> 0.4.7</p>-->
    </div>
    <script src="http://static.alipayobjects.com/seajs/1.2.1/sea.js" data-main="../static/one.js"></script>
    <script src="../static/codes.js"></script>

  <div class="github"><a class="github-link" href="https://github.com/totorojs/javascript-exception-archives">Fork me on GitHub</a></div>

  </body>
</html>